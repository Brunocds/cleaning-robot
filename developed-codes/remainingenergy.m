function remainingenergy = remainingenergy(x)
%The input must be the voltage in mV, and it will return the remaining
%energy (in Joules) of the battery. 

x = x/1000;

%the values below were extracted from an excel file with the experimental 
%relation of battery percentage in function of output voltage, filtred with moving
%average,and are the base to the minimum squares method to create a polynomial
%that converts the voltage output into battery's percentage of energy.
valoresx=[8.20500000000000;8.10906250000000;8.10425000000000;8.10506250000000;8.10581250000000;8.10400000000000;8.10218750000000;8.10037500000000;8.09437500000000;8.09100000000000;8.09443750000000;8.09875000000000;8.10225000000000;8.10143750000000;8.09462500000000;8.08781250000000;8.08437500000000;8.08262500000000;8.08000000000000;8.07562500000000;8.07212500000000;8.07300000000000;8.07562500000000;8.07650000000000;8.07562500000000;8.07387500000000;8.07212500000000;8.07037500000000;8.06775000000000;8.06337500000000;8.05900000000000;8.05637500000000;8.05637500000000;8.05812500000000;8.05900000000000;8.05900000000000;8.05725000000000;8.05112500000000;8.04412500000000;8.04150000000000;8.03975000000000;8.03800000000000;8.03975000000000;8.03975000000000;8.03625000000000;8.03450000000000;8.03450000000000;8.03362500000000;8.03275000000000;8.03275000000000;8.03012500000000;8.02662500000000;8.02662500000000;8.02750000000000;8.02925000000000;8.03187500000000;8.03018750000000;8.02506250000000;8.01906250000000;8.01306250000000;8.01131250000000;8.01293750000000;8.01543750000000;8.01881250000000;8.02050000000000;8.02050000000000;8.02050000000000;8.02137500000000;8.02143750000000;8.01812500000000;8.01393750000000;8.00793750000000;8.00018750000000;7.99500000000000;7.99068750000000;7.98906250000000;7.99175000000000;7.99525000000000;7.99700000000000;7.99437500000000;7.99087500000000;7.98737500000000;7.98300000000000;7.98125000000000;7.97950000000000;7.97687500000000;7.97600000000000;7.97600000000000;7.97600000000000;7.97775000000000;7.97950000000000;7.97600000000000;7.97162500000000;7.97075000000000;7.96900000000000;7.96637500000000;7.96375000000000;7.96025000000000;7.95937500000000;7.96200000000000;7.96462500000000;7.96637500000000;7.96900000000000;7.97162500000000;7.97075000000000;7.96462500000000;7.95762500000000;7.95412500000000;7.95412500000000;7.95762500000000;7.95937500000000;7.95587500000000;7.95237500000000;7.95062500000000;7.94718750000000;7.94468750000000;7.94475000000000;7.94300000000000;7.94293750000000;7.94375000000000;7.94031250000000;7.93775000000000;7.93518750000000;7.93006250000000;7.92581250000000;7.92156250000000;7.91981250000000;7.92312500000000;7.92812500000000;7.92975000000000;7.92550000000000;7.92131250000000;7.91968750000000;7.91981250000000;7.92331250000000;7.92668750000000;7.92662500000000;7.92487500000000;7.92318750000000;7.92156250000000;7.92162500000000;7.92418750000000;7.92668750000000;7.92581250000000;7.92243750000000;7.91906250000000;7.91481250000000;7.91050000000000;7.90700000000000;7.90437500000000;7.90350000000000;7.90437500000000;7.90525000000000;7.90350000000000;7.90000000000000;7.89562500000000;7.89037500000000;7.88687500000000;7.88600000000000;7.88862500000000;7.89300000000000;7.89387500000000;7.89037500000000;7.88162500000000;7.87112500000000;7.86412500000000;7.86237500000000;7.86762500000000;7.87462500000000;7.87900000000000;7.88075000000000;7.87725000000000;7.86937500000000;7.86062500000000;7.85362500000000;7.85012500000000;7.85012500000000;7.85362500000000;7.85368750000000;7.84600000000000;7.83918750000000;7.83925000000000;7.84443750000000;7.85043750000000;7.85131250000000;7.84531250000000;7.83925000000000;7.83662500000000;7.83487500000000;7.83312500000000;7.83050000000000;7.82956250000000;7.83206250000000;7.83206250000000;7.82868750000000;7.82700000000000;7.82781250000000;7.83112500000000;7.83531250000000;7.83618750000000;7.83456250000000;7.83206250000000;7.82868750000000;7.82612500000000;7.82437500000000;7.82350000000000;7.82181250000000;7.81668750000000;7.81068750000000;7.80818750000000;7.80912500000000;7.81000000000000;7.81000000000000;7.80737500000000;7.80125000000000;7.79862500000000;7.79862500000000;7.79512500000000;7.79250000000000;7.78987500000000;7.78462500000000;7.78375000000000;7.78550000000000;7.78550000000000;7.78900000000000;7.79250000000000;7.79075000000000;7.78987500000000;7.78900000000000;7.78550000000000;7.78462500000000;7.78375000000000;7.78025000000000;7.77587500000000;7.76975000000000;7.76450000000000;7.76275000000000;7.76450000000000;7.76800000000000;7.77062500000000;7.77150000000000;7.77150000000000;7.76981250000000;7.76643750000000;7.76218750000000;7.75450000000000;7.74593750000000;7.73906250000000;7.73387500000000;7.73381250000000;7.73725000000000;7.74075000000000;7.74256250000000;7.74181250000000;7.74012500000000;7.73837500000000;7.73831250000000;7.73818750000000;7.73550000000000;7.73456250000000;7.73450000000000;7.73018750000000;7.72500000000000;7.72156250000000;7.71818750000000;7.71650000000000;7.71562500000000;7.71212500000000;7.70687500000000;7.70512500000000;7.70600000000000;7.70512500000000;7.70425000000000;7.70250000000000;7.69900000000000;7.69550000000000;7.69375000000000;7.69287500000000;7.69200000000000;7.69287500000000;7.69112500000000;7.68850000000000;7.68762500000000;7.68237500000000;7.67537500000000;7.67187500000000;7.67100000000000;7.67100000000000;7.67275000000000;7.67537500000000;7.67625000000000;7.67800000000000;7.67887500000000;7.67537500000000;7.67018750000000;7.66506250000000;7.66075000000000;7.65812500000000;7.65637500000000;7.65462500000000;7.65375000000000;7.65118750000000;7.64862500000000;7.64950000000000;7.64868750000000;7.64868750000000;7.65037500000000;7.64956250000000;7.64962500000000;7.64793750000000;7.64193750000000;7.63843750000000;7.63750000000000;7.63406250000000;7.63062500000000;7.62806250000000;7.62293750000000;7.61687500000000;7.61425000000000;7.61425000000000;7.61337500000000;7.61512500000000;7.61950000000000;7.61775000000000;7.61162500000000;7.60550000000000;7.59675000000000;7.58975000000000;7.58887500000000;7.59325000000000;7.59937500000000;7.60375000000000;7.60462500000000;7.60025000000000;7.59587500000000;7.59412500000000;7.59237500000000;7.59062500000000;7.58712500000000;7.58187500000000;7.57925000000000;7.57843750000000;7.57512500000000;7.57012500000000;7.56425000000000;7.55918750000000;7.55575000000000;7.55312500000000;7.55312500000000;7.55312500000000;7.55393750000000;7.55556250000000;7.55025000000000;7.54237500000000;7.53718750000000;7.53206250000000;7.53037500000000;7.53125000000000;7.53037500000000;7.52950000000000;7.52862500000000;7.52687500000000;7.52425000000000;7.52075000000000;7.51900000000000;7.51637500000000;7.51025000000000;7.50587500000000;7.50237500000000;7.49625000000000;7.49275000000000;7.49275000000000;7.49106250000000;7.49118750000000;7.49387500000000;7.49212500000000;7.48775000000000;7.48168750000000;7.47393750000000;7.46962500000000;7.46787500000000;7.46700000000000;7.46531250000000;7.46112500000000;7.45781250000000;7.45700000000000;7.45612500000000;7.45262500000000;7.44825000000000;7.44387500000000;7.43775000000000;7.43337500000000;7.43162500000000;7.43250000000000;7.43775000000000;7.43950000000000;7.43425000000000;7.42725000000000;7.42025000000000;7.41762500000000;7.41850000000000;7.41587500000000;7.41237500000000;7.40887500000000;7.40362500000000;7.40012500000000;7.39662500000000;7.39312500000000;7.39312500000000;7.39312500000000;7.38881250000000;7.38193750000000;7.37675000000000;7.37068750000000;7.36293750000000;7.35781250000000;7.35275000000000;7.34856250000000;7.34950000000000;7.34950000000000;7.34337500000000;7.33812500000000;7.33550000000000;7.33287500000000;7.33287500000000;7.32937500000000;7.32150000000000;7.31625000000000;7.31187500000000;7.30581250000000;7.29725000000000;7.28868750000000;7.28356250000000;7.28106250000000;7.27937500000000;7.27418750000000;7.26381250000000;7.25512500000000;7.24900000000000;7.24200000000000;7.23850000000000;7.23500000000000;7.22887500000000;7.22450000000000;7.21668750000000;7.20637500000000;7.19700000000000;7.18675000000000;7.18081250000000;7.18081250000000;7.18243750000000;7.18150000000000;7.17450000000000;7.16231250000000;7.14931250000000;7.13631250000000;7.12162500000000;7.10437500000000;7.08800000000000;7.08031250000000;7.07862500000000;7.07775000000000;7.07512500000000;7.06381250000000;7.04818750000000;7.03343750000000;7.01350000000000;6.99443750000000;6.98231250000000;6.97193750000000;6.96675000000000;6.96156250000000;6.94943750000000;6.93818750000000;6.92525000000000;6.91056250000000;6.89843750000000;6.88368750000000;6.86543750000000;6.78500000000000];% x - vetor coluna
valoresy=[100.000000000001;99.4813278008308;99.2738589211627;99.0663900414947;98.8589211618266;98.6514522821585;98.4439834024905;98.2365145228224;98.0290456431544;97.8215767634863;97.6141078838183;97.4066390041502;97.1991701244822;96.9917012448141;96.7842323651460;96.5767634854780;96.3692946058099;96.1618257261419;95.9543568464738;95.7468879668058;95.5394190871377;95.3319502074697;95.1244813278016;94.9170124481335;94.7095435684655;94.5020746887974;94.2946058091294;94.0871369294613;93.8796680497933;93.6721991701252;93.4647302904571;93.2572614107891;93.0497925311210;92.8423236514530;92.6348547717849;92.4273858921169;92.2199170124488;92.0124481327808;91.8049792531127;91.5975103734446;91.3900414937766;91.1825726141085;90.9751037344405;90.7676348547724;90.5601659751044;90.3526970954363;90.1452282157682;89.9377593361002;89.7302904564321;89.5228215767641;89.3153526970960;89.1078838174280;88.9004149377599;88.6929460580919;88.4854771784238;88.2780082987557;88.0705394190877;87.8630705394196;87.6556016597516;87.4481327800835;87.2406639004155;87.0331950207474;86.8257261410793;86.6182572614113;86.4107883817432;86.2033195020752;85.9958506224071;85.7883817427391;85.5809128630710;85.3734439834030;85.1659751037349;84.9585062240668;84.7510373443988;84.5435684647307;84.3360995850627;84.1286307053946;83.9211618257266;83.7136929460585;83.5062240663904;83.2987551867224;83.0912863070543;82.8838174273863;82.6763485477182;82.4688796680502;82.2614107883821;82.0539419087141;81.8464730290460;81.6390041493779;81.4315352697099;81.2240663900418;81.0165975103738;80.8091286307057;80.6016597510377;80.3941908713696;80.1867219917016;79.9792531120335;79.7717842323654;79.5643153526974;79.3568464730293;79.1493775933613;78.9419087136932;78.7344398340252;78.5269709543571;78.3195020746890;78.1120331950210;77.9045643153529;77.6970954356849;77.4896265560168;77.2821576763488;77.0746887966807;76.8672199170127;76.6597510373446;76.4522821576765;76.2448132780085;76.0373443983404;75.8298755186724;75.6224066390043;75.4149377593363;75.2074688796682;75.0000000000001;74.7925311203321;74.5850622406640;74.3775933609960;74.1701244813279;73.9626556016599;73.7551867219918;73.5477178423238;73.3402489626557;73.1327800829876;72.9253112033196;72.7178423236515;72.5103734439835;72.3029045643154;72.0954356846474;71.8879668049793;71.6804979253112;71.4730290456432;71.2655601659751;71.0580912863071;70.8506224066390;70.6431535269710;70.4356846473029;70.2282157676349;70.0207468879668;69.8132780082987;69.6058091286307;69.3983402489626;69.1908713692946;68.9834024896265;68.7759336099585;68.5684647302904;68.3609958506223;68.1535269709543;67.9460580912862;67.7385892116182;67.5311203319501;67.3236514522821;67.1161825726140;66.9087136929460;66.7012448132779;66.4937759336098;66.2863070539418;66.0788381742737;65.8713692946057;65.6639004149376;65.4564315352696;65.2489626556015;65.0414937759335;64.8340248962654;64.6265560165973;64.4190871369293;64.2116182572612;64.0041493775932;63.7966804979251;63.5892116182571;63.3817427385890;63.1742738589210;62.9668049792529;62.7593360995849;62.5518672199168;62.3443983402488;62.1369294605807;61.9294605809127;61.7219917012446;61.5145228215766;61.3070539419085;61.0995850622405;60.8921161825724;60.6846473029044;60.4771784232363;60.2697095435683;60.0622406639002;59.8547717842322;59.6473029045641;59.4398340248961;59.2323651452280;59.0248962655600;58.8174273858919;58.6099585062239;58.4024896265558;58.1950207468878;57.9875518672198;57.7800829875517;57.5726141078836;57.3651452282156;57.1576763485476;56.9502074688795;56.7427385892115;56.5352697095434;56.3278008298754;56.1203319502073;55.9128630705393;55.7053941908712;55.4979253112032;55.2904564315351;55.0829875518671;54.8755186721990;54.6680497925310;54.4605809128629;54.2531120331949;54.0456431535268;53.8381742738588;53.6307053941907;53.4232365145227;53.2157676348546;53.0082987551866;52.8008298755185;52.5933609958505;52.3858921161824;52.1784232365144;51.9709543568463;51.7634854771783;51.5560165975102;51.3485477178422;51.1410788381741;50.9336099585061;50.7261410788380;50.5186721991700;50.3112033195019;50.1037344398339;49.8962655601658;49.6887966804978;49.4813278008297;49.2738589211617;49.0663900414936;48.8589211618256;48.6514522821575;48.4439834024895;48.2365145228214;48.0290456431534;47.8215767634853;47.6141078838173;47.4066390041492;47.1991701244812;46.9917012448132;46.7842323651451;46.5767634854770;46.3692946058090;46.1618257261410;45.9543568464729;45.7468879668049;45.5394190871368;45.3319502074688;45.1244813278007;44.9170124481327;44.7095435684646;44.5020746887966;44.2946058091285;44.0871369294605;43.8796680497924;43.6721991701244;43.4647302904563;43.2572614107883;43.0497925311202;42.8423236514522;42.6348547717841;42.4273858921161;42.2199170124480;42.0124481327800;41.8049792531119;41.5975103734439;41.3900414937758;41.1825726141078;40.9751037344397;40.7676348547717;40.5601659751036;40.3526970954356;40.1452282157675;39.9377593360995;39.7302904564314;39.5228215767634;39.3153526970953;39.1078838174273;38.9004149377592;38.6929460580912;38.4854771784231;38.2780082987551;38.0705394190870;37.8630705394190;37.6556016597509;37.4481327800829;37.2406639004148;37.0331950207468;36.8257261410787;36.6182572614107;36.4107883817426;36.2033195020746;35.9958506224065;35.7883817427385;35.5809128630704;35.3734439834024;35.1659751037344;34.9585062240663;34.7510373443983;34.5435684647302;34.3360995850622;34.1286307053941;33.9211618257261;33.7136929460580;33.5062240663900;33.2987551867219;33.0912863070539;32.8838174273858;32.6763485477178;32.4688796680497;32.2614107883817;32.0539419087136;31.8464730290456;31.6390041493775;31.4315352697095;31.2240663900414;31.0165975103734;30.8091286307053;30.6016597510373;30.3941908713692;30.1867219917012;29.9792531120331;29.7717842323651;29.5643153526970;29.3568464730290;29.1493775933609;28.9419087136929;28.7344398340248;28.5269709543568;28.3195020746887;28.1120331950207;27.9045643153526;27.6970954356846;27.4896265560165;27.2821576763485;27.0746887966804;26.8672199170124;26.6597510373443;26.4522821576763;26.2448132780082;26.0373443983402;25.8298755186721;25.6224066390041;25.4149377593360;25.2074688796680;24.9999999999999;24.7925311203319;24.5850622406638;24.3775933609958;24.1701244813277;23.9626556016597;23.7551867219917;23.5477178423236;23.3402489626556;23.1327800829875;22.9253112033195;22.7178423236514;22.5103734439834;22.3029045643153;22.0954356846473;21.8879668049792;21.6804979253112;21.4730290456431;21.2655601659751;21.0580912863070;20.8506224066390;20.6431535269709;20.4356846473029;20.2282157676348;20.0207468879668;19.8132780082987;19.6058091286307;19.3983402489626;19.1908713692946;18.9834024896265;18.7759336099585;18.5684647302904;18.3609958506224;18.1535269709543;17.9460580912863;17.7385892116182;17.5311203319502;17.3236514522821;17.1161825726141;16.9087136929460;16.7012448132780;16.4937759336099;16.2863070539419;16.0788381742738;15.8713692946058;15.6639004149377;15.4564315352697;15.2489626556016;15.0414937759336;14.8340248962655;14.6265560165975;14.4190871369294;14.2116182572614;14.0041493775933;13.7966804979253;13.5892116182572;13.3817427385892;13.1742738589211;12.9668049792531;12.7593360995850;12.5518672199170;12.3443983402490;12.1369294605809;11.9294605809129;11.7219917012448;11.5145228215768;11.3070539419087;11.0995850622407;10.8921161825726;10.6846473029046;10.4771784232365;10.2697095435685;10.0622406639004;9.85477178423236;9.64730290456431;9.43983402489626;9.23236514522822;9.02489626556017;8.81742738589212;8.60995850622407;8.40248962655602;8.19502074688797;7.98755186721992;7.78008298755187;7.57261410788382;7.36514522821577;7.15767634854772;6.95020746887967;6.74273858921162;6.53526970954357;6.32780082987552;6.12033195020747;5.91286307053942;5.70539419087137;5.49792531120332;5.29045643153527;5.08298755186722;4.87551867219917;4.66804979253112;4.46058091286307;4.25311203319502;4.04564315352697;3.83817427385892;3.63070539419087;3.42323651452282;3.21576763485477;3.00829875518672;2.80082987551867;2.59336099585062;2.38589211618257;2.17842323651452;1.97095435684647;1.76348547717842;1.55601659751037;1.34854771784232;1.14107883817427;0.933609958506224;0.726141078838174;0.518672199170125;0];        % y - vetor coluna
vetorfuncao={@(x)ones(size(x)), @(x)x, @(x)x.^2,@(x)x.^3,@(x)x.^4,@(x)x.^5,@(x)x.^6,@(x)x.^7,@(x)x.^8,@(x)x.^9,@(x)x.^10};
n=length(valoresx);
k=length(vetorfuncao);

F(n,k)=0;
for i=1:k
    F(:,i)=vetorfuncao{i}(valoresx);
end

c = (F'*F)\(F'*valoresy);
y(size(x))=0;
for i=1:k
   y=y+c(i)*vetorfuncao{i}(x);

% according to the battery datasheet, it's nominal voltage is 7.4V and it's
% normal capacity is 1550mAh, so according to that it's energy, in Joules,
% when full charge is E = (7.4) J/C * (1400*10^-3) C/s * (1*60*60)s =
% 37296J 

fullbatteryenergy = 37296;

%with one simples rule of three we get the remaining energy: 
% 100% - fullbatteryenergy
% y % - remainingenergy 
remainingenergy = (fullbatteryenergy/100) * y;

end
end
